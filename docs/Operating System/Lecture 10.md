# Operating System - Lecture 10: Virtualization and Virtual Machines

## Overview
Virtualization is a technology that allows multiple operating systems to run on a single physical computer. It abstracts hardware resources and improves resource utilization, providing isolation, flexibility, and better security.

## 1. Virtualization Concepts

### Definition
- Technology that creates virtual (emulated) versions of computing resources
- Abstracts physical resources into logical units
- Enables multiple OS/applications on single hardware
- Creates isolation between virtual environments

### Goals
- **Resource Utilization**: Better use of hardware resources
- **Isolation**: Separate virtual environments
- **Portability**: Move VMs across physical hardware
- **Management**: Centralized administration
- **Security**: Contain compromised systems
- **Scalability**: Easy to add/remove resources

## 2. Virtual Machine (VM) Types

### System Virtual Machines (Hypervisor)
- Emulate entire computer system
- Can run multiple OS on same hardware
- Hypervisor manages VMs
- Examples: VMware ESXi, Hyper-V, KVM

### Process Virtual Machines
- Emulate specific application environment
- Execute programs in protected space
- JVM (Java Virtual Machine)
- Python interpreter
- .NET CLR

## 3. Hypervisors

### Type 1 Hypervisor (Bare-metal)
- Runs directly on hardware
- No host OS needed
- High performance
- Examples: KVM, Xen, VMware ESXi, Hyper-V

### Type 2 Hypervisor (Hosted)
- Runs on host OS
- Depends on host OS
- Easier installation
- Slightly lower performance
- Examples: VMware Workstation, VirtualBox

## 4. Virtualization Techniques

### Full Virtualization
- Complete emulation of hardware
- No changes to guest OS needed
- Can run any OS
- Higher overhead

### Paravirtualization
- Modified OS aware of virtualization
- Guest OS knows it's virtualized
- More efficient than full virtualization
- Requires modified OS
- Example: Xen

### Container-based Virtualization
- Lightweight virtualization
- Shares kernel with host
- Minimal overhead
- More efficient than VMs
- Examples: Docker, LXC

## 5. Virtual Memory Management

### Concept
- Logical memory larger than physical memory
- Part in RAM, part on disk
- Transparent to programs
- Enables running large programs

### Address Translation
1. Virtual address generated by process
2. MMU translates to physical address
3. If page in memory: Direct access
4. If page not in memory: Page fault
5. OS loads page from disk

### Page Table
- Maps virtual pages to physical frames
- Per-process data structure
- Can be hierarchical (multi-level)
- TLB (Translation Lookaside Buffer) caches mappings

## 6. Memory Protection in VMs

### Shadow Page Tables
- VM maintains guest page table
- Hypervisor maintains shadow page table
- Shadow maps guest physical to machine physical
- TLB contains guest-to-machine mappings

### Extended Page Tables (EPT)
- Hardware support for nested page tables
- Reduces VMM intervention
- EPT maps guest physical to machine physical
- More efficient than software approaches

## 7. I/O Virtualization

### Device Emulation
- Hypervisor emulates virtual devices
- Guest OS uses virtual drivers
- I/O requests trapped and processed by hypervisor
- Performance overhead

### Direct Device Assignment
- Guest directly accesses device
- Bypasses hypervisor for data path
- Better performance
- Less isolation

### SR-IOV (Single Root I/O Virtualization)
- Hardware-assisted I/O virtualization
- Device creates virtual functions
- Each VM gets virtual device
- Near-native performance

## 8. Virtual Machine Migration

### Live Migration
- Move running VM between hosts
- Memory pages copied during execution
- Minimal downtime
- Iterative process: Copy dirty pages repeatedly

### Advantages
- Load balancing
- Hardware maintenance
- Disaster recovery
- Resource optimization

### Challenges
- Network bandwidth
- Consistency maintenance
- Downtime minimization
- Storage state migration

## 9. Benefits and Challenges

### Benefits
- **Flexibility**: Run different OS on same hardware
- **Resource Efficiency**: Consolidate multiple servers
- **Isolation**: Faults contained in VM
- **Security**: Better security through separation
- **Portability**: Easy VM migration
- **Scalability**: Add resources dynamically

### Challenges
- **Performance Overhead**: Not fully native performance
- **Complexity**: Additional management layer
- **Resource Overhead**: Hypervisor uses resources
- **Security**: VM escape vulnerabilities
- **Licensing**: Software licensing implications
- **Compatibility**: Not all software compatible

## 10. Cloud Computing and Virtualization

### IaaS (Infrastructure as a Service)
- VMs provided to users
- Amazon EC2, Google Cloud
- User manages OS and applications

### PaaS (Platform as a Service)
- Application platform provided
- User develops on platform
- Provider manages infrastructure

### SaaS (Software as a Service)
- Applications in cloud
- Users access via browser
- No installation needed

## 11. Key Concepts

| Term | Meaning |
|------|----------|
| **VM** | Virtual Computer instance |
| **Hypervisor** | Virtual machine manager |
| **Guest OS** | OS running in VM |
| **Host OS** | OS running hypervisor |
| **Page Fault** | Access to non-resident page |
| **TLB** | Translation buffer cache |
| **Live Migration** | Move running VM between hosts |
| **Snapshot** | VM state at point in time |

---

**Last Updated**: November 28, 2025
**Difficulty Level**: Advanced
**GATE/NET Relevance**: High